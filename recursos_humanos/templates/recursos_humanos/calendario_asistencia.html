{% extends 'core/base.html' %}
{% load static %}

{% block title %}Calendario de Asistencia{% endblock title %}

{% block extra_head %}
{{ block.super }}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.css' rel='stylesheet' />
<style>
    /* Estilos para que el calendario se vea bien en la tarjeta */
    #calendar-container {
        background-color: white;
        padding: 20px;
        border-radius: 1rem;
        box-shadow: 0 5px 15px rgba(0,0,0,.08);
    }
    /* Arregla los colores de los botones del calendario */
    .fc .fc-button-primary {
        background-color: #BF2642; /* Tu color principal */
        border-color: #BF2642;
    }
    .fc .fc-button-primary:hover {
        background-color: #A62139; /* Tono más oscuro */
        border-color: #A62139;
    }
</style>
{% endblock extra_head %}

{% block contenido %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="h3 fw-bold text-dark mb-0">Calendario de Asistencias</h2>
    <a href="{% url 'recursos_humanos:asistencia_manual' %}" class="btn btn-principal">
        <i class="fas fa-plus me-1"></i> Registrar Asistencia Manual
    </a>
</div>

<div id="calendar-container">
    <div id="calendar"></div>
</div>
{% endblock contenido %}

{% block extra_js %}
{{ block.super }}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/locales/es.js'></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth', // Vista de mes (estilo Google)
            locale: 'es', // Poner el calendario en español
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,listWeek' // Vistas disponibles
            },
            editable: false, // No permitir arrastrar eventos
            selectable: true, // Permitir hacer clic en los días
            
            // 4. Aquí está la magia: conectar con tu API de Django
            events: "{% url 'recursos_humanos:api_asistencia_feed' %}",

            // 5. (Opcional) Acción al hacer clic en un día
            dateClick: function(info) {
                // info.dateStr contiene la fecha 'YYYY-MM-DD'
                // Podríamos redirigir al formulario manual pre-llenando la fecha
                let url = `{% url 'recursos_humanos:asistencia_manual' %}`;
                alert('Día seleccionado: ' + info.dateStr + '\n\nPuedes ir a "Registrar Asistencia Manual" para añadir una entrada en esta fecha.');
                
                // (Para una integración avanzada, podrías usar ?fecha=info.dateStr
                // y modificar la vista 'asistencia_manual' para leer ese parámetro)
            }
        });
        
        calendar.render();
    });
</script>
{% endblock extra_js %}