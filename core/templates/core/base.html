{# core/templates/core/base.html #}
{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}Construcciones V&G - Dashboard{% endblock title %}
    </title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    {# Corregido: La ruta debe ser relativa a la carpeta 'static' dentro de STATICFILES_DIRS #}
    <link rel="stylesheet" href="{% static 'app/css/style.css' %}?v=1.3" />

    {% block extra_head %} {% endblock extra_head %}
  </head>
  <body>
    <div class="d-flex" id="wrapper">
      {# Sidebar #}
      <div id="sidebar-wrapper">
        <div class="sidebar-heading text-center py-4 fs-5 fw-bold">
          <i class="fas fa-hard-hat me-2"></i> V&G SPA
        </div>
        <div class="list-group list-group-flush px-3">
          {% block sidebar_menu %} {% if user.is_authenticated %}
          <a
            href="{% url 'core:home' %}" {# Correcto #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'core:home' %}active{% endif %}"
          >
            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
          </a>

          <span class="text-muted small text-uppercase mt-3 mb-1 px-3"
            >Ventas</span
          >
          <a
            href="{% url 'ventas:crear_orden' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'ventas:crear_orden' %}active{% endif %}"
          >
            <i class="fas fa-file-invoice me-2"></i>Crear Comprobante
          </a>
          <a
            href="{% url 'ventas:lista_ordenes' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'ventas:lista_ordenes' %}active{% endif %}"
          >
            <i class="fas fa-history me-2"></i>Ver Órdenes
          </a>
          <a
            href="{% url 'inventario:lista' %}" {# Corregido namespace y nombre #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.url_name == 'lista' and request.resolver_match.namespace == 'inventario' %}active{% endif %}"
          >
            <i class="fas fa-boxes me-2"></i>Inventario
          </a>

          <span class="text-muted small text-uppercase mt-3 mb-1 px-3"
            >Personal</span
          >
          <a
            href="{% url 'recursos_humanos:crear_trabajador' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'recursos_humanos:crear_trabajador' %}active{% endif %}"
          >
            <i class="fas fa-user-plus me-2"></i>Nuevo Trabajador
          </a>
          <a
            href="{% url 'recursos_humanos:lista_trabajadores' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'recursos_humanos:lista_trabajadores' %}active{% endif %}"
          >
            <i class="fas fa-users me-2"></i>Lista Trabajadores
          </a>
          <a
            href="{% url 'recursos_humanos:asistencia_manual' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'recursos_humanos:asistencia_manual' %}active{% endif %}"
          >
            <i class="fa-solid fa-list-check me-2"></i>Asistencia Manual
          </a>
          <a
            href="{% url 'recursos_humanos:calcular_salario' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'recursos_humanos:calcular_salario' %}active{% endif %}"
          >
            <i class="fas fa-calculator me-2"></i>Calcular Salarios
          </a>

          <span class="text-muted small text-uppercase mt-3 mb-1 px-3"
            >Finanzas</span
          >
          <a
            href="{% url 'finanzas:registrar_gasto' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'finanzas:registrar_gasto' %}active{% endif %}"
          >
            <i class="fas fa-dollar-sign me-2"></i>Registrar Gasto
          </a>
          <a
            href="{% url 'finanzas:lista_gastos' %}" {# Corregido namespace #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'finanzas:lista_gastos' %}active{% endif %}"
          >
            <i class="fas fa-receipt me-2"></i>Lista de Gastos
          </a>
          {% else %}
          <a
            href="{% url 'core:login' %}" {# Correcto #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'core:login' %}active{% endif %}"
          >
            <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesión
          </a>
          <a
            href="{% url 'core:register' %}" {# Correcto #}
            class="list-group-item list-group-item-action d-flex align-items-center {% if request.resolver_match.view_name == 'core:register' %}active{% endif %}"
          >
            <i class="fas fa-user-plus me-2"></i>Registrarse
          </a>
          {% endif %} {% endblock sidebar_menu %}
        </div>
      </div>

      {# Page Content #}
      <div id="page-content-wrapper" class="w-100">
        <nav
          class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm"
        >
          <div class="container-fluid">
            {% if user.is_authenticated %}
            <button class="btn btn-outline-primary" id="menu-toggle">
              <i class="fas fa-bars"></i>
            </button>
            {% else %}
            <span></span> {# Espacio reservado para mantener alineación #}
            {% endif %}

             {# Navbar Toggler (para móvil) #}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                {% if user.is_authenticated %}
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    id="navbarDropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <i class="fas fa-user-circle me-1"></i>
                    {{ user.first_name|default:user.username }}
                  </a>
                  <ul
                    class="dropdown-menu dropdown-menu-end"
                    aria-labelledby="navbarDropdown"
                  >
                    <li>
                      <a class="dropdown-item" href="{% url 'core:user_settings' %}" {# Correcto #}
                        ><i class="fas fa-gear me-1"></i> Configuración</a
                      >
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                      <form
                        action="{% url 'core:logout' %}" {# Correcto #}
                        method="post"
                        class="d-inline" {# No necesita d-inline en dropdown #}
                      >
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item">
                          <i class="fas fa-sign-out-alt me-1"></i> Cerrar Sesión
                        </button>
                      </form>
                    </li>
                  </ul>
                </li>
                {% else %}
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'core:login' %}"> {# Correcto #}
                    <i class="fas fa-sign-in-alt me-1"></i> Iniciar Sesión
                  </a>
                </li>
                 <li class="nav-item">
                   <a class="nav-link" href="{% url 'core:register' %}"> {# Correcto #}
                     <i class="fas fa-user-plus me-1"></i> Registrarse
                   </a>
                 </li>
                {% endif %}
              </ul>
            </div>
          </div>
        </nav>

        {# Contenido Principal #}
        <div class="container-fluid py-4">
          {# Mensajes Flash #}
          {% if messages %}
          <div class="row">
            <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2"> {# Ajustado para mejor visualización #}
              {% for message in messages %}
              <div
                class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} alert-dismissible fade show"
                role="alert"
              >
                {{ message }}
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                  aria-label="Close"
                ></button>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          {# Bloque de contenido específico de la página #}
          <div id="contenido">
            {% block contenido %}
            {# El contenido de cada página hija irá aquí #}
            {% endblock contenido %}
          </div>
        </div> {# Fin container-fluid py-4 #}
      </div> {# Fin page-content-wrapper #}
    </div> {# Fin wrapper #}

    {# Scripts JS #}
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script>
      // Toggle sidebar
      document.addEventListener("DOMContentLoaded", function() {
          var menuToggle = document.getElementById('menu-toggle');
          var wrapper = document.getElementById('wrapper');

          if (menuToggle) { // Solo añadir si el botón existe (para usuarios logueados)
              menuToggle.addEventListener('click', function(e) {
                  e.preventDefault();
                  wrapper.classList.toggle('toggled');
              });
          }

          // Esconder el sidebar por defecto en pantallas pequeñas (móviles/tablets)
          // Independientemente de si está logueado o no, para mejorar UX móvil.
          if (window.innerWidth < 992) { // Usar 992px (breakpoint lg de Bootstrap) como referencia
              if (!wrapper.classList.contains('toggled')) {
                   wrapper.classList.add('toggled');
              }
          }

          // Opcional: Volver a mostrar si la ventana se agranda
          window.addEventListener('resize', function() {
              if (window.innerWidth >= 992) {
                  if (wrapper.classList.contains('toggled')) {
                       // Solo quitar 'toggled' si estamos en pantalla grande
                       // Podrías querer que se mantenga oculto si el usuario lo ocultó manualmente
                       // Esta lógica simple lo reabre al agrandar.
                       // wrapper.classList.remove('toggled');
                  }
              } else {
                   if (!wrapper.classList.contains('toggled')) {
                        // Ocultar automáticamente si se achica a menos de lg
                        // wrapper.classList.add('toggled');
                   }
              }
          });
      });
    </script>

    {% block extra_js %}
    {# Scripts adicionales de cada página hija #}
    {% endblock extra_js %}
  </body>
</html>